# Partie 1 : Utilisation des cl√©s priv√©e et publique

La combinaison de cl√©s priv√©e et publique est un m√©canisme tr√®s s√©curis√© pour acc√©der √† un serveur distant. La connexion est authentifi√©e par l'utilisation conjointe de la cl√© priv√©e stock√©e sur la machine de l'utilisateur et de la cl√© publique stock√©e sur le serveur distant.

## 1.1 Cr√©ation des cl√©s

Sous Windows, ouvrez un terminal Bash Ubuntu ([rappel](https://omics-school.github.io/unix-tutorial/tutoriel/README#lancer-un-shell-ubuntu-sous-windows-10) si vous avez oubli√©), puis entrez la commande suivante :

```bash
$ ssh-keygen -t rsa -b 4096 -N "" -C "Connexion GitHub DUO"
```

üîî Rappels :

- Ne tapez pas le `$` en d√©but de ligne et faites attention aux majuscules et aux minuscules.
- Copiez / collez les commandes pour aller plus vite et faire moins d'erreur.

Validez en appuyant sur la touche <kbd>Entr√©e</kbd>.

Vous devriez obtenir quelque chose du type :
```
The key's randomart image is:
+---[RSA 4096]----+
|==..  o          |
|.o+.o. o .       |
| o.+o = =        |
|o +  O . =       |
|.o o  = S +      |
|. . .o + =       |
|   +ooo =        |
|  +o+++o         |
| ..Eo++o.        |
+----[SHA256]-----+
```

Affichez maintenant le contenu du r√©pertoire `~/.ssh/` :

```bash
$ ls ~/.ssh/
```

Vous devriez trouver :

- `id_rsa` : votre cl√© priv√©e. √Ä ne communiquer √† personne ! Cette cl√© doit rester secr√®te.
- `id_rsa.pub` : votre cl√© publique, que vous allez d√©poser sur le site de GitHub.

Toujours dans votre terminal Bash Ubuntu, affichez √† l'√©cran le contenu du fichier `id_rsa.pub` :
```bash
$ cat ~/.ssh/id_rsa.pub
```

Vous devriez obtenir une cl√© qui ressemble √† cela :
```
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCjNrLoIXHG3NHp2eucFnOqicMz2b4I6FvjxVYMEwzO40syopxd
7YtQXzWp9EpuO7n9wWZnZ5uR6bXPqXp9VdN3MviI8PsvvjDbp4AfNz4Onunpy0mIjUarRL5evEPKI2iuqO7pUC9m
qV2tAPopsjfSuj+gBEcMAZU8gMK1o/eBqD+tpuGrNiE1Zq8PDQPOO7HStG09tZ3ABDPBSISun7GAC3ytbYJtL4A3
IEgUX1oCGbrzVGhIB0pK/xKVVpmG6KplVOjsSgYCivfOIJ05GJQk0LuizGWg1rKt4yYZgXjoMW4F+hz/+c9xnDuR
q8ZAQLBAm+NWU91Nczb5OzAfWYVY9BlES35YfcFRLuWP8ArXLHRtZJq48B7wIN39im72iYcKXcOzeyYRZQFKMb0z
9PuDrpZ6LpQZQw04i7CWJZca7Auwtd3yyC+PfuvyeuFhODqktP0rdKtTEQdrUTdaxb+K1k8FPmZMc/o91sBJ1u6d
ceccjpO1LTK/I1w9xmbQAxi0hLDCRN9hm/RUkOvzxZJed6kBzozvZ8vCi+Afv1BXjkv+jrezkkqsFl5YA01nLxyU
zo1LFBNZ41+wRHQXCQKENzsHnuVwZ0CcXRfFoZnDCn9Hs0L7kBH02O2JPbFlIVw/72XaZundqjczcp1w0gou0+Uq
TRTPvbaUnz17wffw== Connexion GitHub DUO
```

Copiez cette cl√©, depuis `ssh-rsa` jusqu'√† `Connexion GitHub DUO` inclus.


## 1.2 Ajout de la cl√© publique dans GitHub

Ouvrez maintenant l'interface de gestion des cl√©s de GitHub : <https://github.com/settings/keys>

*Authentifiez-vous si besoin.*

Cliquez sur le bouton vert ¬´ *New SSH key* ¬ª.

Indiquez comme titre ¬´ Connexion DUO ¬ª (sans les guillemets).

Collez votre cl√© dans le champ *Key* (tout depuis `ssh-rsa` jusqu'√† `Connexion GitHub DUO` inclus).

Enfin, cliquez sur le bouton vert ¬´ *Add SSH key* ¬ª.


## 1.3 Test de la connexion √† GitHub

Pour tester si l'enregistrement de votre cl√© publique dans GitHub a bien fonctionn√©, tapez la commande suivante dans le terminal Bash Ubuntu de votre machine :
```bash
$ ssh -T git@github.com
```
Validez en tapant `yes` puis en appuyant sur <kbd>Entr√©e</kbd>.

Si votre cl√© publique a bien √©t√© enregistr√©e dans GitHub, vous devriez obtenir le message :
```
Hi LOGIN! You've successfully authenticated, but GitHub does not provide shell access.
```
Avec `LOGIN` l'identifiant de votre compte sur GitHub. üéâ


# Partie 2 : Premier d√©p√¥t
## 2.1 Cr√©ation d'un nouveau d√©p√¥t sur GitHub

Dans l'interface de GitHub, tout en haut √† droite, cliquez sur le symbole `+` puis sur ¬´ *New repository* ¬ª :

![](img/github_create_repo1.png)

Indiquez ensuite *duo-test* comme ¬´ *Repository name* ¬ª :

![](img/github_create_repo2.png)

Laissez tous les autres param√®tres par d√©faut.

Puis cliquez sur le bouton vert ¬´ *Create repository* ¬ª.

Enfin, notez et copiez l'adresse de connexion de votre d√©p√¥t qui d√©bute par `git@github.com`, vous en aurez besoin pour la suite :

![](img/github_create_repo3.png)

‚ö†Ô∏è **Attention** ‚ö†Ô∏è Si l'adresse de votre d√©p√¥t ne d√©bute pas par `git@github.com` mais par `https://github.com` alors cliquez sur le bouton gris ¬´ *SSH* ¬ª pour obtenir l'adresse qui d√©bute par `git@github.com`


## 2.2 Connexion du d√©p√¥t distant (sur GitHub) √† votre machine locale

Ouvrez un terminal Bash Ubuntu, puis d√©placez-vous dans le r√©pertoire `/mnt/c/Users/omics/` :

```bash
$ cd /mnt/c/Users/omics/
```

Cr√©ez ensuite le r√©pertoire `intro-git` et d√©placez-vous √† l'int√©rieur :
```bash
$ mkdir -p intro-git
$ cd intro-git
```

V√©rifiez avec la commande `pwd` que vous √™tes dans le bon r√©pertoire :
```bash
$ pwd
/mnt/c/Users/omics/intro-git
```

Ex√©cutez ensuite la commande suivante pour cloner votre d√©p√¥t distant (qui est sur GitHub) sur votre machine locale :
```bash
$ git clone git@github...
```
Pour l'utilisateur `pierrepo`, la commande compl√®te est : `git clone git@github.com:pierrepo/duo-test.git`

**Remarques :**

- git pourra √©ventuellement se plaindre avec le message `warning: You appear to have cloned an empty repository.` C'est tout √† fait normal, le d√©p√¥t est vide pour le moment, mais nous allons rapidement y ajouter des fichiers.
- L'adresse de votre d√©p√¥t distant doit commencer par `git@github.com`

D√©placez-vous maintenant dans le r√©pertoire cr√©√© et qui correspond √† votre d√©p√¥t git :
```bash
$ cd duo-test
```

Affichez le contenu du r√©pertoire.

Ce r√©pertoire ne contient rien. C'est normal, votre d√©p√¥t est vide. Mais ce r√©pertoire est un peu particulier car il contient en fait un r√©pertoire cach√© `.git`. Affichez ce r√©pertoire avec la commande :
```bash
$ ls -al
```
C'est ce r√©pertoire qui va contenir toute la m√©moire du d√©p√¥t, donc tout l'historique du d√©p√¥t. üßê Ne le supprimez pas et ne modifiez pas non plus.


## 2.3 Configuration du d√©p√¥t local

Avant de commencer √† cr√©er et modifier des fichiers dans votre d√©p√¥t, il faut dire √† git qui vous √™tes :
```bash
$ git config --global user.name "Pr√©nom Nom"
$ git config --global user.email "moi@mail.com"
```

*Attention, adaptez le pr√©nom, le nom et l'adresse e-mail √† votre cas. Veillez √† conserver les guillemets autour de `Pr√©nom Nom` dans la premi√®re ligne*.

Remarque : ces commmandes `git config` ne sont √† lancer qu'une seule fois sur votre machine (m√™me si vous avez plusieurs d√©p√¥ts).

V√©rifiez que ces param√®tres sont bien pris en compte avec la commande :

```bash
$ git config --list | grep user
```

Les param√®tres `user.name` et `user.email` devrait contenir les informations que vous avez entr√©es pr√©c√©demment.

## 2.4 Exploration des commandes de base

Toujours dans votre d√©p√¥t git, cr√©ez le fichier `test1.txt` et ajoutez-y du contenu. Vous pouvez faire cela avec l'√©diteur de texte `nano` ou plus rapidement avec la commande suivante :
```bash
$ echo "une premi√®re ligne" > test1.txt
```

Si vous tapez maintenant la commande `git status` pour savoir ce qui se passe, vous devriez obtenir :
```
$ git status
Sur la branche master

Aucun commit

Fichiers non suivis:
  (utilisez "git add <fichier>..." pour inclure dans ce qui sera valid√©)
        test1.txt

aucune modification ajout√©e √† la validation mais des fichiers non suivis sont pr√©sents (utilisez "git add" pour les suivre)
```

Le fichier `test1.txt` existe bien mais il n'est pas encore pris en charge par git. Pour cela, il faut utiliser la commande `git add` :
```bash
$ git add test1.txt
```

Un nouveau `git status` renvoie :
```
$ git status
Sur la branche master

Aucun commit

Modifications qui seront valid√©es :
  (utilisez "git rm --cached <fichier>..." pour d√©sindexer)
        nouveau fichier : test1.txt
```

`test1.txt` est d√©sormais pris en compte par git et ses modifications sont pr√™tes √† √™tre valid√©es. Pour cela, nous allons cr√©er un *commit*, c'est-√†-dire une photo des fichiers :
```bash
$ git commit -m "Premier commit"
```

Vous devriez obtenir un r√©sultat du type :
```bash
$ git commit -m "Premier commit"
[master (commit racine) a7b7006] Premier commit
 1 file changed, 1 insertion(+)
 create mode 100644 test1.txt
```

Parfait ! Il est maintenant temps d'envoyer ce premier *commit* sur GitHub :
```bash
$ git push
√ânum√©ration des objets: 3, fait.
D√©compte des objets: 100% (3/3), fait.
√âcriture des objets: 100% (3/3), 236 octets | 236.00 Kio/s, fait.
Total 3 (delta 0), r√©utilis√©s 0 (delta 0)
To github.com:pierrepo/duo-test.git
 * [new branch]      master -> master
```

Retournez maintenant sur votre navigateur internet et rafraichissez la page de votre d√©p√¥t sur GitHub (a priori `https://github.com/LOGIN/duo-test` avec `LOGIN` votre identifiant GitHub).

Vous devriez voir le fichier `test1.txt` ! ü•≥

![](img/github_first_commit.png)


Depuis le terminal Bash Ubuntu, modifiez une seconde fois le fichier `test1.txt` :
```bash
$ echo "et hop une deuxi√®me ligne !" >> test1.txt
```

Visualisez les diff√©rences par rapport au *commit* pr√©c√©dent avec la commande
```bash
$ git diff
```

Une nouvelle ligne est marqu√©e par le symbole `+`. Une ligne supprim√©e est marqu√©e par le symbole `-`. Les lignes modifi√©es apparaissent avec le symbole `+` et `-`.

Exemple de r√©sultat :
```bash
$ git diff
diff --git a/test1.txt b/test1.txt
index 0d8e693..f9f2480 100644
--- a/test1.txt
+++ b/test1.txt
@@ -1 +1,2 @@
 une premi√®re ligne
+et hop une deuxi√®me ligne !
```

Ajoutez (encore) le fichier modifi√© puis cr√©ez un nouveau *commit* :
```bash
$ git add test1.txt
$ git commit -m "Ajout d'un nouveau message"
```

Et envoyez ce nouveau *commit* sur Github :
```bash
$ git push
√ânum√©ration des objets: 5, fait.
D√©compte des objets: 100% (5/5), fait.
√âcriture des objets: 100% (3/3), 305 octets | 305.00 Kio/s, fait.
Total 3 (delta 0), r√©utilis√©s 0 (delta 0)
To github.com:pierrepo/duo-test.git
   404b6ff..5adb360  master -> master
```

Retournez sur GitHub pour observer ce nouveau *commit* :

![](img/github_second_commit.png)


Depuis le terminal Bash Ubuntu, affichez l'historique avec la commande `git log` :
```bash
$ git log
commit 5adb360b9682320e4fe32382d79d9b9454d657b3 (HEAD -> master, origin/master)
Author: Pierre Poulain <pierre.poulain@cupnet.net>
Date:   Tue Apr 6 21:00:36 2021 +0200

    Ajout d'un nouveau message

commit 404b6ff031bd9ba0daa586c7a524eb8ef409ec1c
Author: Pierre Poulain <pierre.poulain@cupnet.net>
Date:   Tue Apr 6 20:52:47 2021 +0200

    Premier commit
```

Si besoin, pressez la touche <kbd>q</kbd> pour quitter le journal de git.

Vous constatez que git m√©morise :

- **qui** a cr√©√© le *commit* (par exemple : *Pierre Poulain <pierre.poulain@cupnet.net>*) ;
- **quand** le *commit* a √©t√© cr√©√© (par exemple : *Tue Apr 6 21:00:36 2021 +0200*) ;
- et **pourquoi** il a √©t√© cr√©√© (par exempe : *Ajout d'un nouveau message*).

Git m√©morise aussi quels fichiers ont √©t√© modifi√©s. Nous verrons plus tard comment les retrouver.

De plus, git attribue un identifiant √† chaque *commit* (ici : `404b6ff031bd9ba0daa586c7a524eb8ef409ec1c`). Cet identifiant est unique et permet de retrouver un *commit* particulier.

Depuis l'interface de GitHub, cliquez sur le bouton vert ¬´ *Add a README* ¬ª

Dans l'√©diteur en ligne, ajoutez le texte suivant :
```
# duo-test

D√©p√¥t git de test pour le **DU omiques**.
```

![](img/github_readme_1.png)

En bas de la page, indiquez comme titre de *commit* : ¬´ Cr√©ation README.md ¬ª (sans les guillemets), puis cliquez sur le bouton vert ¬´ *Commit new file* ¬ª.

![](img/github_readme_2.png)

Bravo ! Vous avez cr√©√© un nouveau *commit*, mais cette fois dans l'interface de GitHub :

![](img/github_readme_3.png)


Retournez dans le terminal Bash Ubuntu et synchronisez votre d√©p√¥t git local avec GitHub :
```bash
$ git pull
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (4/4), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0
D√©paquetage des objets: 100% (3/3), 716 octets | 358.00 Kio/s, fait.
Depuis github.com:pierrepo/duo-test
   5adb360..4c65a31  master     -> origin/master
Mise √† jour 5adb360..4c65a31
Fast-forward
 README.md | 3 +++
 1 file changed, 3 insertions(+)
 create mode 100644 README.md
```

V√©rifiez que le fichier `README.md` est bien pr√©sent avec la commande `ls` puis affichez son contenu :
```bash
$ cat README.md
```

V√©rifiez √©galement que le *commit* cr√©√© sur GitHub est bien enregistr√© dans l'historique :
```bash
$ git log
```

Si besoin, pressez la touche <kbd>q</kbd> pour quitter le journal de git.


# Partie 3 : Utiliser les cl√©s priv√©e et publique pour une connexion en SSH au serveur de l'IFB

## 3.1 Enregistrement de la cl√© publique sur le serveur de l'IFB

La paire de cl√©s que vous avez cr√©√©e peut √©galement √™tre utile pour vous connecter rapidement sur le serveur de l'IFB, c'est-√†-dire sans entrer votre mot de passe √† chaque fois.

Pour cela, ex√©cutez la commande suivante pour enregistrer votre cl√© publique sur le serveur de l'IFB :
```
$ ssh-copy-id -i ~/.ssh/id_rsa.pub LOGIN@core.cluster.france-bioinformatique.fr
```

avec `LOGIN` votre identifiant sur le serveur de l'IFB. Attention, cet identiant est a priori diff√©rent de celui de GitHub.

Entrez votre mot de passe lorsqu'il est demand√©.

Ex√©cutez ensuite la commande suivante :
```bash
$ ssh LOGIN@core.cluster.france-bioinformatique.fr
```
avec `LOGIN` votre identifiant sur le serveur de l'IFB.

Si la manipulation pr√©c√©dente avec `ssh-copy-id` s'est bien pass√©e, vous devriez pouvoir vous connecter sur le serveur de l'IFB sans entrer de mot de passe. Pratique non ?


## 3.2 Copie de la paire de cl√©s sur le serveur de l'IFB

On peut faire encore plus int√©ressant en copiant la paire de cl√©s sur le serveur de l'IFB.

D√©connectez-vous du serveur de l'IFB en ex√©cutant la commande `exit`.

Depuis le terminal Bash Ubuntu de votre machine locale, copiez votre paire de cl√©s sur le serveur de l'IFB :
```bash
$ scp ~/.ssh/id_rsa* LOGIN@core.cluster.france-bioinformatique.fr:.ssh/
```
avec `LOGIN` votre identifiant sur le serveur de l'IFB.

Connectez-vous au serveur de l'IFB (normalement sans mot de passe) : 
```bash
$ ssh LOGIN@core.cluster.france-bioinformatique.fr
```

Puis clonez votre d√©p√¥t git depuis GitHub :

```bash
$ git clone git@github.com:LOGIN/duo-test.git
```

avec `LOGIN` votre identifiant GitHub (pas celui de l'IFB).

D√©placez-vous ensuite dans le nouveau r√©pertoire cr√©√© :
```bash
$ cd duo-test
```

V√©rifiez avec la commande `git log` que vous avez r√©cup√©r√© tout l'historique du projet.

Vous pouvez ainsi travailler dans votre d√©p√¥t depuis votre machine locale ou le serveur de l'IFB, √† votre convenance. Pensez √† envoyer sur GitHub (`git push`) ou √† t√©l√©charger depuis GitHub (`git pull`) vos modifications r√©guli√®rement.

Si vous travaillez sur le serveur de l'IFB, pensez √† relancer les commandes :

```bash
$ git config --global user.name "Pr√©nom Nom"
$ git config --global user.email "moi@mail.com"
```

*Attention, adaptez le pr√©nom, le nom et l'adresse e-mail √† votre cas.*

Essayez de modifier un fichier ou d'en cr√©er un nouveau, de l'ajouter, de cr√©er un nouveau *commit* puis de l'envoyer sur GitHub. Amusez-vous !



# Partie 4 : Un peu de sp√©l√©o

*Remarque : cette section est l'occasion d'explorer l'historique d'un d√©p√¥t git et d'aborder une nouvelle commande, `git show`.*

J'ai d√©velopp√© il y a quelques ann√©es [autoclasswrapper](https://github.com/pierrepo/autoclasswrapper), un wrapper Python pour le programme de classification bayesienne  [AutoClass C](https://ti.arc.nasa.gov/tech/rse/synthesis-projects-applications/autoclass/autoclass-c/).


Sur votre machine, ouvrez un terminal Bash Ubuntu, puis d√©placez-vous dans le r√©pertoire `/mnt/c/Users/omics/intro-git` :
```bash
$ cd /mnt/c/Users/omics/intro-git
```


T√©l√©chargez l'int√©gralit√© du projet *autoclasswrapper* avec la commande :
```bash
$ git clone https://github.com/pierrepo/autoclasswrapper.git
```

puis d√©placez-vous dans le r√©pertoire du projet :
```bash
$ cd autoclasswrapper
```

### De quand date le dernier *commit* ?

Astuce : combinez les commandes `git log` et `head`.


### Quand a √©t√© cr√©√© le tout premier *commit* ?

Astuce : combinez les commandes `git log` et `tail`.


### Combien de *commits* ont √©t√© enregistr√©s jusqu'√† pr√©sent ?

Astuce : combinez les commandes `git log`, `grep -c` et un mot-cl√© pertinent. V√©rifiez cette valeur sur le site du d√©p√¥t : <https://github.com/pierrepo/autoclasswrapper>

### Trouvez dans quel *commit* j'ai ajout√© la possibilit√© de construire un [dendrogramme](https://en.wikipedia.org/wiki/Dendrogram) ? 

Astuce : combinez les commandes `git log`, `grep -B4` et un mot-cl√© pertinent (en anglais).


### Combien de fichiers ont √©t√© modifi√©s dans le *commit* correspondant ?

Utilisez pour cela la commande

```bash
$ git show --name-only IDENTIFIANT-DU-COMMIT
```

avec `IDENTIFIANT-DU-COMMIT` l'identifiant du *commit* int√©ressant. 

**Aides :** 

- L'identifiant du commit d√©bute par `2d1c`.
- Vous n'avez pas besoin d'entrer l'identifiant complet, les 6 premiers caract√®res devraient suffire.

Notez la diff√©rence avec la commande :
```bash
$ git show IDENTIFIANT-DU-COMMIT
```
Pressez la touche <kbd>q</kbd> pour quitter.




# Partie 5 : Branches et collaboration
## 5.1 Les branches

Revisionez la vid√©o ¬´ [D√©buter avec Git et Github en 30 min](https://youtu.be/hPfgekYUKgk?t=634) ¬ª √† partir de 10'34 sur les branches.

Depuis le terminal Bash Ubuntu de votre machine locale, revenez dans votre d√©p√¥t `duo-test` :
```bash
$ cd /mnt/c/Users/omics/intro-git/duo-test
```

Cr√©ez une nouvelle branche, par exemple *nouveau-fichier* :

```bash
$ git branch nouveau-fichier
```

V√©rifiez que cette branche existe bien :

```bash
$ git branch
* master
  nouveau-fichier
```

Le symbole `*` √† gauche de *master* indique que la branche courante est *master*.

Basculez maintenant sur la branche que vous venez de cr√©er :

```bash
$ git checkout nouveau-fichier
```

V√©rifiez que vous √™tes d√©sormais sur la bonne branche :

```bash
$ git branch
  master
* nouveau-fichier
```

Le symbole `*` √† gauche de *nouveau-fichier* indique que la branche courante est *nouveau-fichier*.

Cr√©ez un nouveau fichier `test2.txt` avec le texte qui vous convient :

```bash
$ echo "Nouveau fichier pour tester une branche" > test2.txt
```

R√©alisez plusieurs *commits* en modifiant √† chaque fois le fichier `test2.txt`, par exemple :

```bash
$ git add test2.txt
$ git commit -m "Cr√©ation d'un nouveau fichier"
$ echo "Une ligne suppl√©mentaire" >> test2.txt
$ git add test2.txt
$ git commit -m "Ajout d'une ligne"
```

Revenez sur la branche *master* et v√©rifiez que le fichier `test2.txt` n'est **pas** pr√©sent :

```bash
$ git checkout master
$ ls
```

Fusionnez maintenant sur *master* la branche *nouveau-fichier* :

```bash
$ git merge nouveau-fichier
```

V√©rifiez que le fichier `test2.txt` est pr√©sent et contient vos modifications :

```bash
$ ls
$ cat test2.txt
```

Supprimez l'ancienne branche *nouveau-fichier* :

```bash
$ git branch -d nouveau-fichier
```

Puis v√©rifiez qu'elle a bien √©t√© d√©truite :

```bash
$ git branch
* master
```

Enfin, envoyez toutes vos modifications sur GitHub :

```bash
$ git push
```

V√©rifiez que le d√©p√¥t sur GitHub a bien √©t√© mis √† jour.


## 5.2 Collaboration avec GitHub

Revisionez la vid√©o ¬´ [D√©buter avec Git et Github en 30 min](https://youtu.be/hPfgekYUKgk?t=1058) ¬ª √† partir de 17'38 sur le d√©p√¥t distant et GitHub.

Explorez le travail collaboratif avec une ou plusieurs autres personnes. 

Remarque : Comme votre d√©p√¥t est d√©j√† sur GitHub, vous n'aurez pas besoin d'ex√©cuter la commande `git remote add...`

